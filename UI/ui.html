<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Electra Dashboard - Active Trip</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
    .gradient-bg { background: linear-gradient(135deg, #7c3aed 0%, #4338ca 100%); }
    .gradient-bar { background: linear-gradient(90deg, #ff7a7a, #ffb86b); }
    .logo-gradient { background: linear-gradient(135deg, #0ea5e9 0%, #22d3ee 100%); }
    .map-bg { background-size: cover; background-position: center; }
    .backdrop-brightness { backdrop-filter: brightness(0.75); }
    @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    .animate-slow-spin { animation: rotate 3s linear infinite; }
    #map { height: 100%; width: 100%; border-radius: 1rem; }
    #controls { position: absolute; top: 20px; left: 20px; z-index: 5; background: rgba(255,255,255,0.95); padding: 15px 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); display: flex; flex-direction: column; gap: 10px; min-width: 250px; }
    #controls input { padding: 8px 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 14px; }
    #controls button { padding: 10px; border: none; background-color: #4285F4; color: white; font-weight: bold; border-radius: 8px; cursor: pointer; transition: 0.2s; }
    #controls button:hover { background-color: #3367D6; }
    #info { margin-top: 10px; background: #f9f9f9; padding: 10px; border-radius: 8px; box-shadow: inset 0 1px 3px rgba(0,0,0,0.1); font-size: 14px; color: #333; }
</style>
</head>
<body class="min-h-screen bg-black text-gray-200 antialiased">

<!-- Top bar -->
<div id="top-bar" class="px-[10px] py-6 flex items-center justify-between">
    <div id="logo-nav" class="flex items-center gap-4">
        <div id="logo-container" class="flex items-center gap-3">
            <div id="logo-icon" class="w-10 h-10 logo-gradient rounded-md flex items-center justify-center">
                <svg class="w-6 h-6 text-black" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M3 12h6M21 6l-8 12H7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
            <div id="logo-text" class="text-xl font-semibold text-cyan-300">Electra</div>
        </div>
        <nav id="nav-links" class="hidden md:flex gap-8 ml-8 text-gray-300">
            <a href="#" class="hover:text-white transition-colors">battery health</a>
            <a href="#" class="hover:text-white transition-colors">home</a>
            <a href="#" class="hover:text-white transition-colors">better health</a>
        </nav>
    </div>
    <div id="profile-actions" class="flex items-center gap-4">
        <button id="profile-btn" class="px-4 py-2 rounded-md bg-gray-800 border border-gray-700 hover:bg-gray-700 transition-colors">Profile</button>
    </div>
</div>

<!-- Page title -->
<div id="page-title" class="px-[10px]">
    <h1 class="text-3xl md:text-4xl font-bold text-white">Active Trip: New York to Boston</h1>
</div>

<!-- Main grid -->
<main id="main-content" class="px-[10px] py-8 grid grid-cols-1 lg:grid-cols-12 gap-6">

    <!-- Left: Map card -->
    <section id="map-section" class="lg:col-span-7 relative">
        <div id="map-card" class="bg-[#0b0b0c] rounded-2xl border border-gray-800 shadow-lg p-4 relative">
            <div id="map-container" class="h-[600px] md:h-[650px] rounded-xl overflow-hidden relative">
                <div id="map"></div>
                <div id="controls">
                    <input id="origin" placeholder="Enter your location" type="text" />
                    <input id="destination" placeholder="Enter destination" type="text" />
                    <button onclick="calculateRoute()">Get Route</button>
                    <div id="info">Distance & Time info will appear here</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Right column: cards -->
    <aside id="sidebar-cards" class="lg:col-span-5 flex flex-col gap-6">

        <!-- Trip Forecast + Action Center -->
        <div class="grid grid-cols-3 gap-1">

            <div id="trip-forecast-card" class="col-span-1 gradient-bg rounded-2xl p-4 shadow-lg border border-gray-800 text-white">
                <div class="flex items-start justify-between">
                    <div>
                        <div class="text-sm text-gray-200">Trip Forecast</div>
                        <div class="text-2xl font-semibold mt-2">Projected Energy:<span class="block text-xl">20.1 kWh</span></div>
                    </div>
                    <div class="w-20 h-20">
                        <div class="radial-chart" data-value="14.5" data-unit="kwh"></div>
                    </div>
                </div>
                <div class="mt-4">
                    <div class="h-3 rounded-full bg-black/30 overflow-hidden">
                        <div class="h-3 rounded-full gradient-bar" style="width: 58%"></div>
                    </div>
                    <div class="flex justify-between text-xs text-gray-200 mt-2">
                        <div>Remaining Range</div>
                        <div>20.1 km</div>
                    </div>
                    <div class="mt-3 text-sm">ETA: 2h 45m</div>
                </div>
            </div>

            <div id="action-center-card" class="col-span-2 bg-[#0f1112] rounded-2xl p-4 shadow-lg border border-gray-800">
                <div class="text-sm text-cyan-300 font-medium">Action Center</div>
                <div class="mt-3 bg-gray-900 rounded-md p-3 flex items-center justify-between">
                    <div>
                        <div class="text-sm font-semibold">Recommended Action:</div>
                        <div class="text-sm text-gray-300">Continue Trip</div>
                    </div>
                    <div class="text-green-400 font-bold">✓</div>
                </div>
                <div class="mt-3 text-xs text-gray-400">Potential Stops: 2</div>
                <div class="mt-2 text-xs text-gray-500">Tip: Maintain steady speed</div>
            </div>
        </div>

        <!-- Gauges Card -->
        <div id="gauges-card" class="bg-[#0f1112] rounded-2xl p-4 shadow-lg border border-gray-800">
            <div class="grid grid-cols-3 gap-3">
                <div class="gauge-container">
                    <div class="text-xs text-gray-400 mb-3">State of Charge</div>
                    <div class="flex items-center justify-center">
                        <div class="gauge" data-value="75" data-unit="%" data-max="100"></div>
                    </div>
                    <div class="text-xs text-gray-500 text-center mt-2">SoC</div>
                </div>
                <div class="gauge-container">
                    <div class="text-xs text-gray-400 mb-3">Voltage</div>
                    <div class="flex items-center justify-center">
                        <div class="gauge" data-value="433" data-unit="V" data-max="500"></div>
                    </div>
                    <div class="text-xs text-gray-500 text-center mt-2">V</div>
                </div>
                <div class="gauge-container">
                    <div class="text-xs text-gray-400 mb-3">Trip Consumption</div>
                    <div class="flex items-center justify-center">
                        <div class="gauge" data-value="14.5" data-unit="kWh" data-max="40"></div>
                    </div>
                    <div class="text-xs text-gray-500 text-center mt-2">kWh</div>
                </div>
            </div>
        </div>

        <!-- Live Coincy Coach Card -->
        <div id="coincy-coach-card" class="bg-[#0f1112] rounded-2xl p-4 shadow-lg border border-gray-800">
            <div class="text-sm text-cyan-300 font-medium">Live Coincy Coach</div>
            <div class="mt-4 flex items-center gap-4">
                <div class="w-20">
                    <div class="radial-chart green" data-value="92" data-unit="%"></div>
                </div>
                <div>
                    <div class="text-lg font-semibold">92%</div>
                    <div class="text-xs text-gray-400">Current Efficiency</div>
                    <div class="text-xs text-gray-500 mt-2">Tip: Maintain steady speed</div>
                </div>
            </div>
        </div>

        <!-- Battery Analytics Card -->
        <div id="battery-analytics-card" class="bg-[#0f1112] rounded-2xl p-4 shadow-lg border border-gray-800">
            <div class="text-sm text-cyan-300 font-medium">Detailed Battery Analytics</div>
            <div class="mt-3">
                <div class="h-28 w-full bg-gradient-to-b from-gray-900 to-gray-800 rounded-lg p-3">
                    <div id="bar-chart" class="h-full flex items-end gap-2"></div>
                </div>
            </div>
        </div>

    </aside>
</main>

<footer id="footer" class="px-[10px] py-6 text-gray-600 text-sm">
    © <span id="current-year"></span> Electra — Dashboard clone
</footer>

<script>
    // Set current year
    document.getElementById('current-year').textContent = new Date().getFullYear();

    // Radials
    function createRadialChart(element) {
        const value = parseFloat(element.dataset.value) || 50;
        const unit = element.dataset.unit || '%';
        const isGreen = element.classList.contains('green');
        const maxValue = element.dataset.max ? parseFloat(element.dataset.max) : (unit === '%' ? 100 : 100);
        const percentage = Math.max(0, Math.min(100, (value / maxValue) * 100));
        const circumference = 100;
        const strokeDasharray = `${percentage} ${circumference - percentage}`;
        element.innerHTML = `<div class="relative w-20 h-20 flex items-center justify-center">
            <svg viewBox="0 0 36 36" class="w-20 h-20 transform -rotate-90">
                <path d="M18 2a16 16 0 1 1 0 32" fill="none" stroke="#111827" stroke-width="3" />
                <path d="M18 2a16 16 0 1 1 0 32" fill="none" stroke="${isGreen ? '#10b981' : '#60a5fa'}" stroke-width="3" stroke-dasharray="${strokeDasharray}" stroke-linecap="round" />
            </svg>
            <div class="absolute text-center">
                <div class="text-sm font-semibold">${value}</div>
                <div class="text-xs text-gray-400">${unit}</div>
            </div>
        </div>`;
    }

    // Gauges
    function createGauge(element) {
        const value = parseFloat(element.dataset.value) || 50;
        const unit = element.dataset.unit || '%';
        const maxValue = parseFloat(element.dataset.max) || 100;
        const percentage = Math.max(0, Math.min(100, (value / maxValue) * 100));
        const circumference = 100;
        const strokeDasharray = `${percentage} ${circumference - percentage}`;
        element.innerHTML = `<div class="w-20 h-20 relative">
            <svg viewBox="0 0 36 36" class="w-full h-full transform -rotate-90">
                <path d="M18 2a16 16 0 1 1 0 32" fill="none" stroke="#111827" stroke-width="3" />
                <path d="M18 2a16 16 0 1 1 0 32" fill="none" stroke="#60a5fa" stroke-width="3" stroke-dasharray="${strokeDasharray}" stroke-linecap="round" />
            </svg>
            <div class="absolute inset-0 flex items-center justify-center text-sm font-semibold">${value}${unit}</div>
        </div>`;
    }

    // Bar chart
    function createBarChart() {
        const container = document.getElementById('bar-chart');
        for (let i=0;i<16;i++){
            const bar = document.createElement('div');
            const height = 12 + (i%6)*8;
            bar.className='w-3 bg-cyan-500 rounded-sm transition-all duration-500 hover:bg-cyan-400';
            bar.style.height = `${height}px`;
            container.appendChild(bar);
        }
    }

    document.addEventListener('DOMContentLoaded', function(){
        document.querySelectorAll('.radial-chart').forEach(createRadialChart);
        document.querySelectorAll('.gauge').forEach(createGauge);
        createBarChart();
        document.querySelectorAll('.gauge').forEach(gauge=>{
            gauge.addEventListener('mouseenter',()=>{gauge.style.transform='scale(1.05)';gauge.style.transition='transform 0.2s ease';});
            gauge.addEventListener('mouseleave',()=>{gauge.style.transform='scale(1)';});
        });
        setInterval(()=>{
            const randomGauge = document.querySelectorAll('.gauge')[Math.floor(Math.random()*3)];
            if(randomGauge){
                const currentValue=parseFloat(randomGauge.dataset.value);
                const variation=(Math.random()-0.5)*2;
                const newValue=Math.max(0,currentValue+variation);
                randomGauge.dataset.value=newValue.toFixed(1);
                createGauge(randomGauge);
            }
        },5000);
    });

    // Google Maps
    let map,directionsService,directionsRenderer,trafficLayer,placesService;
    function initMap(){
        map=new google.maps.Map(document.getElementById("map"),{center:{lat:28.6139,lng:77.2090},zoom:13});
        directionsService=new google.maps.DirectionsService();
        directionsRenderer=new google.maps.DirectionsRenderer({map:map,suppressMarkers:false});
        trafficLayer=new google.maps.TrafficLayer();
        trafficLayer.setMap(map);
        placesService=new google.maps.places.PlacesService(map);
        if(navigator.geolocation){
            navigator.geolocation.getCurrentPosition(position=>{
                const userLoc={lat:position.coords.latitude,lng:position.coords.longitude};
                map.setCenter(userLoc);
                document.getElementById("origin").value=`${userLoc.lat}, ${userLoc.lng}`;
            },()=>console.log("Geolocation not allowed"));
        }
    }

    function calculateRoute(){
        const origin=document.getElementById("origin").value;
        const destination=document.getElementById("destination").value;
        directionsService.route({origin,destination,travelMode:google.maps.TravelMode.DRIVING,drivingOptions:{departureTime:new Date(),trafficModel:'bestguess'}},(result,status)=>{
            if(status==="OK"){
                directionsRenderer.setDirections(result);
                const leg=result.routes[0].legs[0];
                const distance=leg.distance.text;
                const duration=leg.duration.text;
                const durationInTraffic=leg.duration_in_traffic?leg.duration_in_traffic.text:duration;
                let trafficLevel="Unknown";
                if(leg.duration_in_traffic){
                    const normalSec=leg.duration.value;
                    const trafficSec=leg.duration_in_traffic.value;
                    const diffPercent=((trafficSec-normalSec)/normalSec)*100;
                    trafficLevel=diffPercent<20?"Low":diffPercent<50?"Medium":"High";
                }
                document.getElementById("info").innerHTML=`<strong>Distance:</strong> ${distance} <br><strong>Estimated Time:</strong> ${duration} <br><strong>Traffic Level:</strong> ${trafficLevel}`;
                const txtContent=`Origin: ${origin}\nDestination: ${destination}\nDistance: ${distance}\nEstimated Time: ${duration}\nTraffic Level: ${trafficLevel}`;
                const blob=new Blob([txtContent],{type:"text/plain"});
                const link=document.createElement("a");
                link.href=URL.createObjectURL(blob);
                link.download="route_info.txt";
                link.click();
                showEVStationsAlongRoute(result.routes[0]);
            }else{alert("Error: "+status);}
        });
    }

    function showEVStationsAlongRoute(route){
    const path = route.overview_path;
    const addedStations = new Set();

    for(let i = 0; i < path.length; i += 10){
        const point = path[i];

        setTimeout(() => {
            const request = {
                location: point,
                radius: 10000, // increased radius
                type: "charging_station" // correct type
            };

            placesService.nearbySearch(request, (results, status) => {
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                    results.forEach(place => {
                        if (!addedStations.has(place.place_id)) {
                            addedStations.add(place.place_id);

                            const marker = new google.maps.Marker({
                                position: place.geometry.location,
                                map,
                                icon: {
                                    url: "chargingstat.jpg",
                                    scaledSize: new google.maps.Size(40, 40)
                                },
                                title: place.name
                            });

                            const infowindow = new google.maps.InfoWindow({
                                content: `<strong>${place.name}</strong><br>${place.vicinity || ""}`
                            });

                            marker.addListener("click", () => infowindow.open(map, marker));
                        }
                    });
                } else {
                    console.warn("Places API status:", status);
                }
            });
        }, i * 300);
    }
}
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDM9IOtER3IK3AOQDv0S1OghmgKIJoCsh4&libraries=places&callback=initMap" async defer></script>
</body>
</html>
